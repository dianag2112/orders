<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Menu ‚Äî Magelan</title>

    <link href="https://fonts.googleapis.com/css2?family=Pirata+One&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/styles.css}" href="/styles.css">
    <link rel="stylesheet" th:href="@{/menu.css}" href="/menu.css">
</head>

<body class="app-page menu-page">
<div class="bg" aria-hidden="true"></div>

<header class="top-logo">
    <a th:href="@{/home}" class="top-logo__link" href="/home" aria-label="Back to Home">
        <img src="/magelan-index.jpg" alt="Magelan Logo" class="top-logo__img">
    </a>
    <div class="top-logo__subtitle">Menu</div>
</header>

<main class="wrap">
    <section class="panel">

        <div class="menu-head">
            <h1 class="title">Captain‚Äôs Menu</h1>

            <div class="menu-tools">
                <div class="search">
                    <input id="menuSearch" class="search__input" type="search"
                           placeholder="Search treasure‚Ä¶ (e.g. rum, steak)">
                    <span class="search__icon" aria-hidden="true">‚åï</span>
                </div>
            </div>
        </div>

        <div th:if="${menuMessage}" class="menu-alert" th:text="${menuMessage}">
            Item updated.
        </div>

        <!-- ADD NEW (compact single row) -->
        <form class="add-row"
              th:action="@{/menu/products}"
              th:object="${productForm}"
              method="post">

            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

            <input class="add-input add-name"
                   th:field="*{name}"
                   type="text"
                   placeholder="New item name‚Ä¶"
                   required>

            <input class="add-input add-price"
                   th:field="*{price}"
                   type="number"
                   step="0.01"
                   min="0"
                   placeholder="0.00"
                   required>

            <select class="add-input add-cat" th:field="*{category}" required>
                <option value="" disabled selected>Category</option>
                <option th:each="c : ${categories}" th:value="${c}" th:text="${c}"></option>
            </select>

            <button class="icon-btn icon-btn--ok" type="submit" title="Add">Ôºã</button>
        </form>

        <!-- category chips -->
        <div class="chips" aria-label="Categories">
            <a class="chip" href="#STARTER">Starters / –ü—Ä–µ–¥—è—Å—Ç–∏—è</a>
            <a class="chip" href="#MAIN">Mains / –û—Å–Ω–æ–≤–Ω–∏ —è—Å—Ç–∏—è</a>
            <a class="chip" href="#DESSERT">Desserts / –î–µ—Å–µ—Ä—Ç–∏</a>
            <a class="chip" href="#DRINK">Drinks / –ù–∞–ø–∏—Ç–∫–∏</a>
        </div>

        <!-- ================= STARTER ================= -->
        <section class="category" id="STARTER">
            <div class="category__bar">
                <h2 class="category__title">Starters</h2>
                <span class="category__hint">–ü—Ä–µ–¥—è—Å—Ç–∏—è</span>
            </div>

            <div class="rows">
                <div class="row" th:each="p : ${starters}">
                    <form class="row-form"
                          th:action="@{/menu/products/{id}/edit(id=${p.id})}"
                          method="post">

                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <input type="hidden" name="category" value="STARTER">

                        <div class="c-name">
                            <span class="text" th:text="${p.name}">Bruschetta</span>
                            <input class="edit-input" name="name" th:value="${p.name}" required>
                        </div>

                        <div class="c-price">
              <span class="text"
                    th:text="${#numbers.formatDecimal(p.price, 1, 'POINT', 2, 'POINT')} + ' ‚Ç¨'">9.90 ‚Ç¨</span>
                            <input class="edit-input edit-price" name="price" type="number" step="0.01" min="0"
                                   th:value="${p.price}" required>
                        </div>

                        <div class="c-actions">
                            <button class="icon-btn" type="button" data-edit title="Edit">‚úé</button>
                            <button class="icon-btn icon-btn--ok" type="submit" data-save title="Save">‚úì</button>
                        </div>
                    </form>

                    <form class="inline"
                          th:action="@{/menu/products/{id}/delete(id=${p.id})}"
                          method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <button class="icon-btn icon-btn--danger" type="submit" title="Delete">üóë</button>
                    </form>
                </div>

                <div class="empty" th:if="${#lists.isEmpty(starters)}">
                    No starters yet.
                </div>
            </div>
        </section>

        <!-- ================= MAIN ================= -->
        <section class="category" id="MAIN">
            <div class="category__bar">
                <h2 class="category__title">Mains</h2>
                <span class="category__hint">–û—Å–Ω–æ–≤–Ω–∏ —è—Å—Ç–∏—è</span>
            </div>

            <div class="rows">
                <div class="row" th:each="p : ${mains}">
                    <form class="row-form"
                          th:action="@{/menu/products/{id}/edit(id=${p.id})}"
                          method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <input type="hidden" name="category" value="MAIN">

                        <div class="c-name">
                            <span class="text" th:text="${p.name}">Steak</span>
                            <input class="edit-input" name="name" th:value="${p.name}" required>
                        </div>

                        <div class="c-price">
              <span class="text"
                    th:text="${#numbers.formatDecimal(p.price, 1, 'POINT', 2, 'POINT')} + ' ‚Ç¨'">15.90 ‚Ç¨</span>
                            <input class="edit-input edit-price" name="price" type="number" step="0.01" min="0"
                                   th:value="${p.price}" required>
                        </div>

                        <div class="c-actions">
                            <button class="icon-btn" type="button" data-edit title="Edit">‚úé</button>
                            <button class="icon-btn icon-btn--ok" type="submit" data-save title="Save">‚úì</button>
                        </div>
                    </form>

                    <form class="inline" th:action="@{/menu/products/{id}/delete(id=${p.id})}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <button class="icon-btn icon-btn--danger" type="submit" title="Delete">üóë</button>
                    </form>
                </div>

                <div class="empty" th:if="${#lists.isEmpty(mains)}">No mains yet.</div>
            </div>
        </section>

        <!-- ================= DESSERT ================= -->
        <section class="category" id="DESSERT">
            <div class="category__bar">
                <h2 class="category__title">Desserts</h2>
                <span class="category__hint">–î–µ—Å–µ—Ä—Ç–∏</span>
            </div>

            <div class="rows">
                <div class="row" th:each="p : ${desserts}">
                    <form class="row-form"
                          th:action="@{/menu/products/{id}/edit(id=${p.id})}"
                          method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <input type="hidden" name="category" value="DESSERT">

                        <div class="c-name">
                            <span class="text" th:text="${p.name}">Cake</span>
                            <input class="edit-input" name="name" th:value="${p.name}" required>
                        </div>

                        <div class="c-price">
              <span class="text"
                    th:text="${#numbers.formatDecimal(p.price, 1, 'POINT', 2, 'POINT')} + ' ‚Ç¨'">7.90 ‚Ç¨</span>
                            <input class="edit-input edit-price" name="price" type="number" step="0.01" min="0"
                                   th:value="${p.price}" required>
                        </div>

                        <div class="c-actions">
                            <button class="icon-btn" type="button" data-edit title="Edit">‚úé</button>
                            <button class="icon-btn icon-btn--ok" type="submit" data-save title="Save">‚úì</button>
                        </div>
                    </form>

                    <form class="inline" th:action="@{/menu/products/{id}/delete(id=${p.id})}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <button class="icon-btn icon-btn--danger" type="submit" title="Delete">üóë</button>
                    </form>
                </div>

                <div class="empty" th:if="${#lists.isEmpty(desserts)}">No desserts yet.</div>
            </div>
        </section>

        <!-- ================= DRINK ================= -->
        <section class="category" id="DRINK">
            <div class="category__bar">
                <h2 class="category__title">Drinks</h2>
                <span class="category__hint">–ù–∞–ø–∏—Ç–∫–∏</span>
            </div>

            <div class="rows">
                <div class="row" th:each="p : ${drinks}">
                    <form class="row-form"
                          th:action="@{/menu/products/{id}/edit(id=${p.id})}"
                          method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <input type="hidden" name="category" value="DRINK">

                        <div class="c-name">
                            <span class="text" th:text="${p.name}">Rum</span>
                            <input class="edit-input" name="name" th:value="${p.name}" required>
                        </div>

                        <div class="c-price">
              <span class="text"
                    th:text="${#numbers.formatDecimal(p.price, 1, 'POINT', 2, 'POINT')} + ' ‚Ç¨'">6.50 ‚Ç¨</span>
                            <input class="edit-input edit-price" name="price" type="number" step="0.01" min="0"
                                   th:value="${p.price}" required>
                        </div>

                        <div class="c-actions">
                            <button class="icon-btn" type="button" data-edit title="Edit">‚úé</button>
                            <button class="icon-btn icon-btn--ok" type="submit" data-save title="Save">‚úì</button>
                        </div>
                    </form>

                    <form class="inline" th:action="@{/menu/products/{id}/delete(id=${p.id})}" method="post">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <button class="icon-btn icon-btn--danger" type="submit" title="Delete">üóë</button>
                    </form>
                </div>

                <div class="empty" th:if="${#lists.isEmpty(drinks)}">No drinks yet.</div>
            </div>
        </section>

    </section>
</main>

<footer class="footer-rope">
    <div class="rope"></div>
    <p class="footer-text">‚öì Magelan ‚Ä¢ Captain‚Äôs Menu</p>
</footer>

<script>
    // toggle edit mode per row
    document.addEventListener('click', (e) => {
        const editBtn = e.target.closest('[data-edit]');
        if (!editBtn) return;

        const row = editBtn.closest('.row');
        if (!row) return;

        row.classList.toggle('is-editing');
    });

    // search filter
    const input = document.getElementById('menuSearch');
    input?.addEventListener('input', (e) => {
        const q = e.target.value.toLowerCase().trim();
        document.querySelectorAll('.row').forEach(row => {
            const name = row.querySelector('.c-name .text')?.textContent?.toLowerCase() || '';
            row.style.display = name.includes(q) ? '' : 'none';
        });
    });
</script>

</body>
</html>
